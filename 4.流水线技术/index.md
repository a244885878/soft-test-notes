### 流水线概念

- 相关参数计算：`流水线执行时间计算`、`流水线吞吐率`、流水线加速比、流水线效率
- 流水线是指在程序执行时`多条指令重叠进行操作`的一种准并行处理实现技术。各种部件同时处理是针对不同指令而言的，它们可同时为多条指令的不同部分进行工作，以提高各部件的利用率和指令的平均执行速度。

> `取指`=> `分析` => `执行` 取指、分析、执行各 1ms 执行 3 条指令。

### 流水线 - 流水线计算

- **流水线周期** 为执行时间最长的一段
- **流水线计算公式** 为：

1 条指令执行时间 + (指令条数 - 1) × 流水线周期

---

#### 公式

**① 理论公式：**  
$$(t_1 + t_2 + \cdots + t_k) + (n-1) \times t$$

**② 实践公式：**  
$$k \times t + (n-1) \times t$$

---

#### 示例说明

一条指令的执行过程可以分解为 **取指、分析和执行三步**：

- 取指时间：$t_{取指} = 3\Delta t$
- 分析时间：$t_{分析} = 2\Delta t$
- 执行时间：$t_{执行} = 4\Delta t$

在这种情况下：

- 若 **按串行方式执行**，则 10 条指令全部执行完成需要：  
  $$9*10=90\Delta t$$

- 若 **按流水线方式执行**，流水线周期为：  
   $$4\Delta t$$

  则 10 条指令全部执行完成需要：  
   $$9*(10-1)*4=45\Delta t$$

  `若理论公式没有答案使用实践公式：`（各段被“拉齐”为周期 t，每段都按 4Δt 记）
  首条指令延迟 = 3 段 × 4Δt = 12Δt
  10 条指令：12Δt + (10-1)×4Δt = 12 + 36 = 48Δt

### 流水线 - 流水线吞吐率计算

🌞 **流水线的吞吐率**（Through Put rate, TP）  
指在单位时间内，流水线所完成的任务数量或输出的结果数量。

计算流水线吞吐率的最基本公式为：

$$
TP = \frac{\text{指令条数}}{\text{流水线执行时间}}
$$

---

🌞 **流水线最大吞吐率：**

$$
TP_{max} = \lim_{n \to \infty} \frac{n}{(k+n-1)t} = \frac{1}{t}
$$

---

#### 示例

一条指令的执行过程可以分解为 **取指、分析和执行三步**：

- 取指时间 $t_{取指} = 3\Delta t$
- 分析时间 $t_{分析} = 2\Delta t$
- 执行时间 $t_{执行} = 4\Delta t$

求：**10 条指令的吞吐率？**

### 10 条指令吞吐率计算

#### 已知条件

- 取指时间：$t_{取指} = 3\Delta t$
- 分析时间：$t_{分析} = 2\Delta t$
- 执行时间：$t_{执行} = 4\Delta t$
- 流水线周期：$t = \max(3, 2, 4) = 4\Delta t$
- 指令条数：$n = 10$

---

#### 计算执行时间

**公式：**

$$
T = (t_1 + t_2 + \cdots + t_k) + (n-1) \times t
$$

代入：

$$
T = (3 + 2 + 4)\Delta t + (10 - 1)\times 4\Delta t
$$

$$
T = 9\Delta t + 36\Delta t = 45\Delta t
$$

---

#### 吞吐率计算

**公式：**

$$
TP = \frac{n}{T}
$$

代入：

$$
TP = \frac{10}{45\Delta t}
$$

---

#### 结果

- **10 条指令执行时间：** $45\Delta t$
- **吞吐率：** $TP = \frac{10}{45\Delta t}$

* **最大吞吐率**： $ = \frac{1}{4\Delta t}$

## 真题

#### 下列关于流水线方式执行指令的叙述中，不正确的是()

- A：流水线方式可提高单条指令的执行速度
- B：流水线方式下可同时执行多条指令
- C：流水线方式提高了各部件的利用率
- D：流水线方式提高了系统的吞吐率

> 答案：A

#### 将一条指令的执行过程分解为取指、分析和执行三步，按照流水方式执行，若取指时间 t 取指=4△t、分析时间 t 分析=2△t、执行时间 t 执行=3△t，则执行完 100 条指令，需要的时间为（ ）△t。

- A、200
- B、300
- C、400
- D、405

> 答案：D、(2+3+4)+(100-1)\*4 = 405
> 流水线执行时间是 $\frac{100}{405\Delta t}$
> 最大吞吐率是$\frac{1}{4\Delta t}$
